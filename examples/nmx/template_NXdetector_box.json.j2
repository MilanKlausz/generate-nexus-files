            {
              "name": "{{ j2_detector_name }}",
              "type": "group",
              "attributes": [
                {
                  "dtype": "string",
                  "name": "NX_class",
                  "values": "NXdetector"
                }
              ],
              "children": [
                {
                  "attributes": [
                    {
                      "dtype": "string",
                      "name": "NX_class",
                      "values": "NXcite"
                    }
                  ],
                  "children": [
                    {
                      "config": {
                        "name": "description",
                        "type": "string",
                        "values": "The data here was produced using the ESS EFU (European Spallation Source Event Formation Unit) system"
                      },
                      "module": "dataset"
                    },
                    {
                      "config": {
                        "name": "doi",
                        "type": "string",
                        "values": "https://doi.org/10.1088/1748-0221/13/10/T10001"
                      },
                      "module": "dataset"
                    },
                    {
                      "config": {
                        "name": "bibtex",
                        "type": "string",
                        "values": "@article{Christensen_2018,\r\ndoi = {10.1088/1748-0221/13/11/T11002},\r\nurl = {https://dx.doi.org/10.1088/1748-0221/13/11/T11002},\r\nyear = {2018},\r\nmonth = {nov},\r\npublisher = {},\r\nvolume = {13},\r\nnumber = {11},\r\npages = {T11002},\r\nauthor = {M.J. Christensen and M. Shetty and J. Nilsson and A. Mukai and R. Al Jebali and A. Khaplanov and M. Lupberger and F. Messi and D. Pfeiffer and F. Piscitelli and T. Blum and C. S\u00f8gaard and S. Skelboe and R. Hall-Wilton and T. Richter},\r\ntitle = {Software-based data acquisition and processing for neutron detectors at European Spallation Source\u2014early experience from four detector designs},\r\njournal = {Journal of Instrumentation},\r\nabstract = {European Spallation Source (ESS) will deliver neutrons at high flux for use in diverse neutron scattering techniques. The neutron source facility and the scientific instruments will be located in Lund, and the Data Management and Software Centre (DMSC), in Copenhagen.   A number of detector prototypes are being developed at ESS together with its European in-kind partners, for example: SoNDe, Multi-Grid, Multi-Blade and Gd-GEM. These are all position sensitive detectors but use different techniques for the detection of neutrons.   Except for digitization of electronics readout, all neutron data is anticipated to be processed in software. This provides maximum flexibility and adaptability and allows deep inspection of the raw data for commissioning which will reduce the risk of starting up new detector technologies. But it also requires development of high performance software processing pipelines and optimized and scalable processing algorithms.   This report provides a description of the ESS system architecture for the neutron data path. Special focus is on the interface between the detectors and DMSC which is based on UDP over Ethernet links.   The report also describes the software architecture for detector data processing and the tools we have developed, which have proven very useful for efficient early experimentation, and can be run on a single laptop.   Processing requirements for the SoNDe, Multi-Grid, Multi-Blade and Ge-GEM   detectors are presented and compared to event processing rates archived so far.}\r\n}"
                      },
                      "module": "dataset"
                    },
                    {
                      "config": {
                        "name": "endnote",
                        "type": "string",
                        "values": "%0 Journal Article\n%T Software-based data acquisition and processing for neutron detectors at European Spallation Source\u201a\u00c4\u00eeearly experience from four detector designs\n%A Christensen, M. J.\n%A Shetty, M.\n%A Nilsson, J.\n%A Mukai, A.\n%A Jebali, R. Al\n%A Khaplanov, A.\n%A Lupberger, M.\n%A Messi, F.\n%A Pfeiffer, D.\n%A Piscitelli, F.\n%A Blum, T.\n%A S\u221a?gaard, C.\n%A Skelboe, S.\n%A Hall-Wilton, R.\n%A Richter, T.\n%J Journal of Instrumentation\n%D 2018\n%8 nov\n%V 13\n%N 11\n%F Christensen_2018\n%X European Spallation Source (ESS) will deliver neutrons at high flux for use in diverse neutron scattering techniques. The neutron source facility and the scientific instruments will be located in Lund, and the Data Management and Software Centre (DMSC), in Copenhagen. A number of detector prototypes are being developed at ESS together with its European in-kind partners, for example: SoNDe, Multi-Grid, Multi-Blade and Gd-GEM. These are all position sensitive detectors but use different techniques for the detection of neutrons. Except for digitization of electronics readout, all neutron data is anticipated to be processed in software. This provides maximum flexibility and adaptability and allows deep inspection of the raw data for commissioning which will reduce the risk of starting up new detector technologies. But it also requires development of high performance software processing pipelines and optimized and scalable processing algorithms. This report provides a description of the ESS system architecture for the neutron data path. Special focus is on the interface between the detectors and DMSC which is based on UDP over Ethernet links. The report also describes the software architecture for detector data processing and the tools we have developed, which have proven very useful for efficient early experimentation, and can be run on a single laptop. Processing requirements for the SoNDe, Multi-Grid, Multi-Blade and Ge-GEM detectors are presented and compared to event processing rates archived so far.\n%U https://dx.doi.org/10.1088/1748-0221/13/11/T11002\n%U http://dx.doi.org/10.1088/1748-0221/13/11/T11002\n%P 11002"
                      },
                      "module": "dataset"
                    }
                  ],
                  "name": "efu_publication",
                  "type": "group"
                },
                {
                  "attributes": [
                    {
                      "dtype": "string",
                      "name": "NX_class",
                      "values": "NXgeometry"
                    }
                  ],
                  "children": [
                    {
                      "attributes": [
                        {
                          "dtype": "string",
                          "name": "NX_class",
                          "values": "NXshape"
                        }
                      ],
                      "children": [
                        {
                          "attributes": [
                            {
                              "dtype": "string",
                              "name": "units",
                              "values": "mm"
                            }
                          ],
                          "config": {
                            "name": "size",
                            "type": "double",
                            "values": {{ j2_detector_sizes }}
                          },
                          "module": "dataset"
                        },
                        {
                          "config": {
                            "name": "shape",
                            "type": "string",
                            "values": "nxbox"
                          },
                          "module": "dataset"
                        }
                      ],
                      "name": "shape",
                      "type": "group"
                    }
                  ],
                  "name": "geometry",
                  "type": "group"
                },
                {
                  "attributes": [
                    {
                      "dtype": "string",
                      "name": "units",
                      "values": "mm"
                    }
                  ],
                  "config": {
                    "name": "x_pixel_offset",
                    "type": "float",
                    "values": [{% for value in j2_x_pixel_offsets %}{{ "%.6f" | format(value) }}{% if not loop.last %}, {% endif %}{% endfor %}]
                  },
                  "module": "dataset"
                },
                {
                  "attributes": [
                    {
                      "dtype": "string",
                      "name": "units",
                      "values": "mm"
                    }
                  ],
                  "config": {
                    "name": "y_pixel_offset",
                    "type": "float",
                    "values": [{% for value in j2_y_pixel_offsets %}{{ "%.6f" | format(value) }}{% if not loop.last %}, {% endif %}{% endfor %}]
                  },
                  "module": "dataset"
                },
                {
                  "attributes": [
                    {
                      "dtype": "string",
                      "name": "units",
                      "values": "mm"
                    }
                  ],
                  "config": {
                    "name": "z_pixel_offset",
                    "type": "float",
                    "values": [{% for value in j2_z_pixel_offsets %}{{ "%.6f" | format(value) }}{% if not loop.last %}, {% endif %}{% endfor %}]

                  },
                  "module": "dataset"
                },
                {
                  "config": {
                    "name": "detector_number",
                    "type": "int32",
                    "values": {{ j2_detector_numbers }}
                  },
                  "module": "dataset"
                },
                {
                  "name": "event_data",
                  "type": "group",
                  "attributes": [
                    {
                      "name": "NX_class",
                      "dtype": "string",
                      "values": "NXevent_data"
                    }
                  ],
                  "children": [
                    {
                      "module": "ev44",
                      "config": {
                        "source": "{{ j2_instrument_name }}_{{ j2_detector_name }}",
                        "topic": "{{ j2_instrument_name }}_detector"
                      }
                    }
                  ]
                }
                {%- if j2_detector_transformations|length > 0 %},
                {
                  "config": {
                    "name": "depends_on",
                    "values": "/entry/instrument/{{ j2_detector_name }}/transformations/{% if j2_detector_transformations|last|get_item('config') is not none %}{{ j2_detector_transformations|last|get_item('config')|get_item('name') }}{% else %}{{ j2_detector_transformations|last|get_item('name') }}{% endif %}"
                  },
                  "module": "dataset"
                },
                {
                  "name": "transformations",
                  "type": "group",
                  "attributes": [
                    {
                      "name": "NX_class",
                      "values": "NXtransformations"
                    }
                  ],
                  "children": {{ j2_detector_transformations | tojson }}
                }
                {%- endif %}
              ]
            }
